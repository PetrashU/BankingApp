<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Enter Password</title>
        <style>
            .password-input {
                width: 20px;
                margin: 5px;
                text-align: center;
            }
            .number-label {
                width: 20px;
                margin: 5px;
                text-align: center;
                font-weight: bold;
            }
            .disabled {
                background-color: #e0e0e0;
            }
            .container {
                display: flex;
            }
            .input-container {
                display: flex;
                flex-direction: column;
                align-items: center;
            }
        </style>
    </head>
    <body>
        <h1>Enter Password for {{ username }}</h1>
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <ul class="flash-messages">
                    {% for message in messages %}
                        <li>{{ message }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}
        <form method="post" id="passwordForm">
            <div class="container">
                {% for i in range(16) %}
                    <div class="input-container">
                        <label for="char{{ i+1 }}" class="number-label">{{ i+1 }}</label>
                        <input type="password" id="char{{ i+1 }}" name="char{{ i+1 }}" maxlength="1" class="password-input" disabled />
                    </div>
                {% endfor %}
            </div>
            <br>
            <input type="submit" value="Submit">
        </form>

        <script>

            var enabled_positions = {{ enabled_positions | tojson }};
        
            enabled_positions.forEach(function(pos) {
                var inputField = document.getElementById('char' + pos);
                if (inputField) {
                    inputField.disabled = false;
                    inputField.classList.remove('disabled');
                }
            });
        
            enabled_positions.forEach(function (pos, index) {
                var inputField = document.getElementById('char' + pos);
        
                if (inputField) {
                    inputField.addEventListener('input', function (event) {
                        handleInput(event, index);
                    });
                    inputField.addEventListener('keydown', function (event) {
                        handleKeydown(event, index);
                    });
                }
            });
        
            function handleInput(event, index) {
                // Move to the next cell after input
                if (index < enabled_positions.length - 1) {
                    var nextInputField = document.getElementById('char' + enabled_positions[index + 1]);
                    if (nextInputField && (event.inputType === 'insertText' || event.inputType !== 'deleteContentBackward')) {
                        nextInputField.focus();
                    }
                }
            }
        
            function handleKeydown(event, index) {
                // Get the key code for Backspace
                var backspaceKeyCode = 8;
        
                // Move to the previous cell on Backspace, only if the current cell is empty
                if (event.keyCode === backspaceKeyCode && event.target.value === '') {
                    if (index > 0) {
                        var previousInputField = document.getElementById('char' + enabled_positions[index - 1]);
                        if (previousInputField) {
                            previousInputField.focus();
                        }
                    }
                }
            }
        
        </script>
    </body>
</html>
